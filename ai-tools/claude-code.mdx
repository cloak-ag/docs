---
title: "Claude Code setup"
description: "Configure Claude Code for Cloak SDK development"
icon: "message-bot"
---

Configure Claude Code (Claude's coding assistant) with Cloak SDK context for effective pair programming on private transaction implementations.

## System prompt

Add this context when working on Cloak SDK projects:

<Accordion title="View system prompt content">

# Cloak SDK Context

I'm working with the Cloak SDK (@cloak.ag/sdk) for private transactions on Solana.

## SDK Capabilities
- Deposit SOL into privacy pool → generates CloakNote
- Withdraw privately to any recipient
- Multi-recipient transfers (up to 5 addresses)
- Private token swaps (SOL → SPL tokens)
- Zero-knowledge proof generation (Groth16)

## Critical Security Requirements
1. CloakNote contains spending secrets (sk_spend, r) - NEVER log or expose
2. Always use onNoteGenerated callback to persist notes BEFORE deposits
3. Treat notes like private keys - anyone with the note can spend funds

## SDK Initialization

**Node.js:**
```typescript
const sdk = new CloakSDK({
  keypairBytes: keypair.secretKey,
  network: "devnet",
});
```

**React/Browser:**
```typescript
const sdk = new CloakSDK({
  wallet: { publicKey, signTransaction, sendTransaction },
  network: "devnet",
});
```

## Core Methods
- `sdk.deposit(connection, amount, options)` → DepositResult
- `sdk.withdraw(connection, note, recipient, options)` → TransferResult  
- `sdk.send(connection, note, recipients, options)` → TransferResult
- `sdk.swap(connection, note, recipient, swapOptions)` → SwapResult

## Fee Structure
- Fixed: 0.003 SOL per withdrawal
- Variable: 0.5% of deposit amount
- Use `getDistributableAmount(amount)` to calculate after-fee amount

## Error Handling
CloakError has category (wallet|network|prover|relay|validation|indexer) 
and retryable boolean for implementing retry logic.

</Accordion>

## CLAUDE.md file

Create a `CLAUDE.md` file in your project root for persistent context:

<Accordion title="View CLAUDE.md template">

# Cloak SDK Integration

This project uses @cloak.ag/sdk for private Solana transactions.

## Project Structure
- `/hooks/useCloak.ts` - SDK hook with wallet integration
- `/components/PrivateTransfer.tsx` - Main transfer UI
- `/utils/noteStorage.ts` - Encrypted note persistence

## Environment Variables
- `NEXT_PUBLIC_CLOAK_NETWORK` - "devnet" or "mainnet"
- `NEXT_PUBLIC_SOLANA_RPC` - RPC endpoint URL

## Development Commands
- `npm run dev` - Start development server
- `npm run build` - Production build
- `npm run test` - Run tests

## Key Patterns

**Safe Note Handling:**
```typescript
await sdk.deposit(connection, amount, {
  onNoteGenerated: async (note) => {
    await encryptAndSaveNote(note);
  },
});
```

**Fee Calculations:**
```typescript
import { getDistributableAmount } from "@cloak.ag/sdk";
const afterFees = getDistributableAmount(note.amount);
```

**Error Categories:**
```typescript
if (error instanceof CloakError) {
  switch (error.category) {
    case "wallet": // Connection or signing issues
    case "network": // RPC failures
    case "prover": // Proof generation errors
    case "relay": // Withdrawal submission errors
  }
}
```

## Security Notes
- Never log CloakNote objects (contain secrets)
- Store notes in encrypted storage only
- Implement onNoteGenerated for crash recovery

</Accordion>

## SDK Reference for Claude

<Accordion title="View API quick reference">

## CloakSDK Class

### Constructor Options
| Option | Type | Description |
|--------|------|-------------|
| keypairBytes | Uint8Array | For Node.js signing |
| wallet | WalletAdapter | For browser signing |
| network | Network | "devnet" or "mainnet" |
| cloakKeys | CloakKeyPair | For note scanning (v2.0) |
| debug | boolean | Enable logging |

### Methods

**deposit(connection, amount, options)**

Deposits SOL into the privacy pool.

Returns: `DepositResult { note, signature, leafIndex, root }`

Options:
- `onNoteGenerated: (note) => Promise<void>` - CRITICAL for safety
- `onProgress: (status) => void`

**withdraw(connection, note, recipient, options)**

Withdraws to a single recipient.

Returns: `TransferResult { signature, outputs, nullifier, root }`

Options:
- `withdrawAll: boolean` (default: true)
- `amount: number` (if not withdrawing all)

**send(connection, note, recipients, options)**

Sends to multiple recipients (1-5).

Recipients must sum to `getDistributableAmount(note.amount)`.

**swap(connection, note, recipient, options)**

Swaps SOL for SPL tokens.

Options:
- `outputMint: string` (required)
- `slippageBps: number` (default: 100)
- `minOutputAmount: number` (required if no getQuote)

## Utility Functions

- `getDistributableAmount(amount)` - Calculates amount after protocol fees
- `calculateFee(amount)` - Returns total fee (fixed + variable)
- `isValidSolanaAddress(address)` - Validates Solana address format

## Types

**CloakNote:**
```typescript
{
  version: string;
  amount: number;
  commitment: string;    // hex
  sk_spend: string;      // hex - SECRET
  r: string;             // hex - SECRET
  timestamp: number;
  network: Network;
  leafIndex?: number;
  depositSignature?: string;
}
```

**CloakError:**
```typescript
{
  category: "wallet" | "network" | "prover" | "relay" | "validation" | "indexer";
  retryable: boolean;
  message: string;
}
```

</Accordion>

## Effective prompts

### Basic integration

```
I need to integrate Cloak SDK into my React app for private payments.

Requirements:
- Using @solana/wallet-adapter-react for wallet connection
- Need deposit and withdraw functionality
- Show progress during proof generation
- Handle errors gracefully

Create the necessary hooks and components.
```

### Error handling

```
Add comprehensive error handling to this Cloak SDK integration:

[paste your code]

Requirements:
- Catch CloakError and handle by category
- Implement retry logic for retryable errors
- Show user-friendly messages
- Never log sensitive note data
```

### Note persistence

```
Implement secure note persistence for my Cloak integration:

Requirements:
- Encrypt notes before storing in localStorage
- Implement the onNoteGenerated callback
- Add note recovery functionality
- Support listing and managing saved notes
```

## Best practices for Claude

<AccordionGroup>
<Accordion title="Provide context about your setup">
Tell Claude:
- React/Next.js or Node.js environment
- Whether using wallet adapter
- Your existing patterns and conventions
</Accordion>

<Accordion title="Reference documentation">
Point Claude to specific SDK methods or types when asking questions.
</Accordion>

<Accordion title="Share error messages">
When debugging, share the full CloakError with category and message.
</Accordion>

<Accordion title="Security review requests">
Ask Claude to review security: note handling, onNoteGenerated implementation, error message sanitization.
</Accordion>
</AccordionGroup>

<Tip>
When starting a new conversation about an existing project, paste your CLAUDE.md contents to give Claude full context.
</Tip>
