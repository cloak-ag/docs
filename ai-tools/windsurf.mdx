---
title: "Windsurf setup"
description: "Configure Windsurf IDE for Cloak SDK development"
icon: "wind"
---

Configure Windsurf (Codeium's AI IDE) for effective Cloak SDK development. These rules help the AI understand SDK patterns and security requirements.

## Cascade rules

Create `.windsurf/rules.md` in your project for Cascade context:

<Accordion title="View .windsurf/rules.md content">

# Cloak SDK Development Rules

## Overview
This project uses @cloak.ag/sdk for private Solana transactions via zero-knowledge proofs.

## SDK Capabilities
- Deposit SOL into privacy pool (returns CloakNote)
- Private withdrawals to any recipient
- Multi-recipient transfers (up to 5)
- Token swaps (SOL â†’ SPL tokens)
- On-chain Merkle proof computation (no external indexer needed)

## SECURITY CRITICAL

**CloakNote contains secrets:**
```typescript
interface CloakNote {
  sk_spend: string;  // SPENDING SECRET - never log
  r: string;         // RANDOMNESS SECRET - never log
}
```

**Always persist notes BEFORE deposit:**
```typescript
await sdk.deposit(connection, amount, {
  onNoteGenerated: async (note) => {
    await saveNoteSecurely(note);
  },
});
```

## Initialization Patterns

**Node.js:**
```typescript
import { CloakSDK } from "@cloak.ag/sdk";

const sdk = new CloakSDK({
  keypairBytes: keypair.secretKey,
  network: "devnet",
  debug: true,
});
```

**React/Browser:**
```typescript
import { CloakSDK } from "@cloak.ag/sdk";
import { useWallet } from "@solana/wallet-adapter-react";

const { publicKey, signTransaction, sendTransaction } = useWallet();

const sdk = new CloakSDK({
  wallet: { publicKey, signTransaction, sendTransaction },
  network: "devnet",
});
```

## Core Operations

**Deposit:**
```typescript
const result = await sdk.deposit(connection, amountLamports, {
  onNoteGenerated: async (note) => {
    await persistNote(note);
  },
});
```

**Withdraw:**
```typescript
const result = await sdk.withdraw(connection, note, recipientPubkey, {
  withdrawAll: true,
});
```

**Multi-send:**
```typescript
import { getDistributableAmount } from "@cloak.ag/sdk";

const distributable = getDistributableAmount(note.amount);
await sdk.send(connection, note, [
  { recipient: addr1, amount: distributable / 2 },
  { recipient: addr2, amount: distributable / 2 },
]);
```

**Swap:**
```typescript
await sdk.swap(connection, note, recipient, {
  outputMint: "USDC_MINT_ADDRESS",
  slippageBps: 100,
  minOutputAmount: 1_000_000,
});
```

## Fee Calculations
- Fixed: 0.003 SOL per withdrawal
- Variable: 0.5% of deposit amount

```typescript
import { getDistributableAmount, calculateFee } from "@cloak.ag/sdk";

const afterFees = getDistributableAmount(depositAmount);
const totalFee = calculateFee(depositAmount);
```

## Error Handling
```typescript
import { CloakError } from "@cloak.ag/sdk";

try {
  await sdk.withdraw(...);
} catch (error) {
  if (error instanceof CloakError) {
    // error.category: wallet | network | prover | relay | validation | environment
    // error.retryable: boolean
    if (error.retryable) {
      // Implement retry logic
    }
  }
}
```

## Key Validations
1. Check `note.leafIndex !== undefined` before withdraw
2. Recipient amounts must sum to `getDistributableAmount(note.amount)`
3. Max 5 recipients per transfer
4. Notes can only be spent once (nullifier prevents double-spend)

</Accordion>

## Workspace configuration

Create a `.windsurf/config.json` for project settings:

```json
{
  "project": {
    "name": "cloak-integration",
    "description": "Private transactions with Cloak SDK"
  },
  "context": {
    "documentation": [
      "https://docs.cloak.ag/sdk"
    ],
    "types": [
      "node_modules/@cloak.ag/sdk/dist/index.d.ts"
    ]
  },
  "rules": [
    "Never log or expose CloakNote objects",
    "Always implement onNoteGenerated for deposits",
    "Use getDistributableAmount() for recipient calculations",
    "Handle CloakError with category-specific logic"
  ]
}
```

## Cascade prompts

### Initialize SDK hook

```
Create a React hook for Cloak SDK that:
1. Initializes when wallet connects
2. Exposes deposit, withdraw, and send functions
3. Handles loading and error states
4. Uses @solana/wallet-adapter-react
```

### Safe deposit flow

```
Implement a deposit function with:
1. onNoteGenerated callback saving to encrypted storage
2. Progress callback updating UI
3. Error handling with CloakError categories
4. Loading state management
```

### Multi-recipient component

```
Build a MultiRecipientTransfer component:
1. Dynamic recipient inputs (1-5)
2. Auto-calculate per-recipient amounts after fees
3. Validate total matches distributable amount
4. Show fee breakdown
5. Handle proof generation progress
```

### Error handling layer

```
Create an error handling utility for Cloak operations:
1. Parse CloakError by category
2. Show appropriate user messages
3. Implement retry for retryable errors
4. Log safely (never log note secrets)
```

## Codeium context tips

<AccordionGroup>
<Accordion title="Index SDK types">
Open `node_modules/@cloak.ag/sdk/dist/index.d.ts` to let Windsurf index all types and function signatures.
</Accordion>

<Accordion title="Keep examples visible">
Keep working Cloak integration code open in a tab. Windsurf uses visible files for better suggestions.
</Accordion>

<Accordion title="Add JSDoc comments">
Document your Cloak-related functions with JSDoc for improved autocomplete.
</Accordion>

<Accordion title="Use inline comments">
Add context comments near complex Cloak operations.
</Accordion>
</AccordionGroup>

## Security checklist

Before committing Cloak integration code, verify:

- No CloakNote objects logged anywhere
- onNoteGenerated callback implemented for all deposits
- Notes stored in encrypted storage (not plain localStorage)
- Error messages don't expose note contents
- No hardcoded private keys or secrets
- Circuit files excluded from version control (if local)

<Warning>
Windsurf's code suggestions may sometimes include logging statements. Always review generated code to ensure no sensitive CloakNote data is logged.
</Warning>

## Next steps

<CardGroup cols={2}>
<Card title="SDK quickstart" icon="rocket" href="/sdk/quickstart">
Complete your first private transaction.
</Card>

<Card title="Wallet integration" icon="wallet" href="/sdk/wallet-integration">
Full React/Next.js integration guide.
</Card>
</CardGroup>
